# ã€æœºå™¨å­¦ä¹ åº”ç”¨ã€‘ã€Pythonã€‘å†³ç­–æ ‘ Decision Tree

å†³ç­–æ ‘æœ¬è´¨ä¸Šæ˜¯if/elseè¯­å¥çš„é›†åˆï¼Œé€šè¿‡å›ç­”ä¸€çº§ä¸€çº§çš„if/elseé—®é¢˜ï¼Œæœ€ç»ˆåšå‡ºå†³ç­–ã€‚æ¯”å¦‚ï¼Œæˆ‘ä»¬åˆ©ç”¨å†³ç­–æ ‘æ¥åˆ¤æ–­ä¸€ä¸ªäººæ˜¯eäººè¿˜æ˜¯iäººï¼Œæˆ‘ä»¬å°±æœ‰å¯èƒ½å½¢æˆä»¥ä¸‹å†³ç­–æ ‘:
![](pic/../pics/dt2.png)

ç¬¬ä¸€ä¸ªé—®é¢˜è¢«ç§°ä¸º**æ ¹èŠ‚ç‚¹(root)**ï¼Œä¹‹åçš„æ¯ä¸€ä¸ªåˆ†æ”¯èŠ‚ç‚¹è¢«ç§°ä¸º**å¶å­(leaf)**ï¼Œè¿™æ˜¯ä¸€ä¸ªæ·±åº¦ä¸º4ï¼Œå¶å­ä¸º6çš„ç®€å•å†³ç­–æ ‘ã€‚

## å†³ç­–æ ‘çš„å½¢æˆ
æ„å»ºä¸€æ£µå†³ç­–æ ‘ï¼Œä¸åŒçš„é—®é¢˜é¡ºåºï¼Œå¯èƒ½ä¼šå¾—å‡ºä¸ä¸€æ ·çš„ç»“æœã€‚å›åˆ°å®é™…é—®é¢˜ä¸­ï¼Œä¸€ç»„æ•°æ®æœ‰å¤šä¸ªç‰¹å¾ï¼Œæˆ‘ä»¬åº”è¯¥é€‰æ‹©å“ªäº›ç‰¹å¾æ„å»ºå†³ç­–æ ‘ï¼Œå¦‚ä½•å†³å®šé¡ºåºæ‰èƒ½å¤Ÿè¾¾åˆ°æ›´é«˜çš„æ•ˆç‡(æ›´å¿«ã€æ›´å‡†)å‘¢ï¼Ÿ

æŠ›å¼€æ•°å­¦å…¬å¼æ¥ç†è§£ï¼Œå…¶å®å°±æ˜¯çœ‹å“ªä¸€ä¸ªç‰¹å¾èƒ½æ›´æœ‰æ•ˆåœ°åˆ†ç±»æ•°æ®é›†ã€‚ä»€ä¹ˆæ˜¯æ›´æœ‰æ•ˆåœ°åˆ†ç±»ï¼Ÿç»“åˆå¼€å¤´çš„ä¾‹å­ï¼Œå¦‚æœä»…â€œæ˜¯å¦æ›´å–œæ¬¢ç‹¬å¤„â€œè¿™ä¸€ä¸ªé—®é¢˜ï¼Œå›ç­”â€œæ˜¯â€çš„äººå…¨éƒ½æ˜¯iäººï¼Œå›ç­”â€œä¸æ˜¯â€çš„å…¨éƒ½æ˜¯eäººï¼Œä¸€ä¸ªé—®é¢˜å°±å¯ä»¥å°†eäºº/iäººåŒºåˆ†å¼€ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±è®¤ä¸ºï¼Œè¿™æ˜¯ä¸ªæœ‰æ•ˆé—®é¢˜ã€‚

ä½†å¦‚æœè¿™ä¸ªé—®é¢˜å›ç­”â€œæ˜¯â€çš„äººä¸­ï¼Œiäººå’Œeäººå„å ä¸€åŠï¼Œé‚£å’Œæ·éª°å­æ²¡ä»€ä¹ˆåŒºåˆ«ï¼Œä¹Ÿå°±æ˜¯ä¸€ä¸ªæ²¡æ— æ•ˆé—®é¢˜ã€‚

![](pics/dt.GIF)

å›åˆ°å†³ç­–æ ‘ç®—æ³•ä¸­ï¼Œè¡¡é‡é—®é¢˜ï¼ˆä¹Ÿå°±æ˜¯ç‰¹å¾ï¼‰æ˜¯å¦æœ‰ç”¨/æœ‰æ•ˆçš„æŒ‡æ ‡ï¼Œå«åš**åŸºå°¼ç³»æ•°**ï¼ˆä¹Ÿæ˜¯ç»æµå­¦ä¸­ç”¨æ¥è¡¡é‡è´«å¯Œå·®è·çš„æŒ‡æ ‡ï¼‰ã€‚**åŸºå°¼ç³»æ•°æ ¹æ®æ•°æ®é›†ä¸­å„ç±»åˆ«æ‰€å æ¯”ä¾‹è®¡ç®—å¾—å‡ºï¼Œæ ¹æ®ä¸€ä¸ªç‰¹å¾åˆ†ç±»åçš„æ•°æ®é›†åŸºå°¼ç³»æ•°è¶Šå°ï¼Œä»£è¡¨è¿™ä¸ªç‰¹å¾è¶Šæœ‰æ•ˆã€‚**

ä½†åœ¨åˆ¤æ–­æ˜¯å¦é€‰å–ä¸€ä¸ªç‰¹å¾åšèŠ‚ç‚¹æ—¶ï¼Œè€ƒè™‘çš„æ˜¯åˆ†ç±»å‰æ•°æ®é›†çš„åŸºå°¼ç³»æ•°$gini_{after}$æ˜¯å¦å°äºæœªåˆ†ç±»å‰çš„æ•°æ®é›†çš„åŸºå°¼ç³»æ•°$gini_{before}$ï¼Œå¦‚æœ$gini_{before} \leq gini_{after}$ï¼Œå°½ç®¡$gini_{after}$å†å°ï¼Œä¹Ÿä¸ç®—æœ‰æ•ˆç‰¹å¾ã€‚$gini_{before}$å’Œ$gini_{after}$ä¹‹é—´çš„å·®å¼‚ç§°ä¸º**ä¿¡æ¯å¢ç›Š**ï¼Œå½“ä¸€ä¸ªç‰¹å¾å¸¦æ¥çš„ä¿¡æ¯å¢ç›Šä¸ºæ­£ä¸”åœ¨æ‰€æœ‰ç‰¹å¾ä¸­æœ€å¤§æ—¶ï¼Œå†³ç­–æ ‘å°±é€‰å–è¿™ä¸ªç‰¹å¾åšèŠ‚ç‚¹ã€‚

é™¤æ­¤ä¹‹å¤–ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ç”¨**ä¿¡æ¯ç†µ**æ¥è¡¡é‡ä¸€ä¸ªç‰¹å¾æ˜¯å¦æœ‰æ•ˆã€‚
> **ä¿¡æ¯ç†µ**ç”¨äºè¡¡é‡æ•°æ®é›†ä¸­ä¿¡æ¯æ··ä¹±ç¨‹åº¦ï¼Œä¹Ÿå°±æ˜¯ä¸€ç»„æ•°æ®é‡Œå¦‚æœä»€ä¹ˆç±»åˆ«éƒ½æœ‰ï¼Œä¿¡æ¯ç†µå°±é«˜ï¼Œåä¹‹å¦‚æœåªæœ‰ä¸€ç§ç±»åˆ«ï¼Œä¿¡æ¯ç†µä¸º0.

æ ¹æ®åŸºå°¼ç³»æ•°æˆ–ä¿¡æ¯å¢ç›Šï¼Œé…åˆæ›´è¯¦ç»†çš„ç®—æ³•è®¾è®¡ï¼Œæˆ‘ä»¬å¯ä»¥å°†å†³ç­–æ ‘ç®—æ³•åˆ†ä¸ºä¸‰ç±»ï¼š
* **ID3å†³ç­–æ ‘** - ä¿¡æ¯ç†µ
* **C4.5å†³ç­–æ ‘** - ä¿¡æ¯å¢ç›Šç‡
* **CARTå†³ç­–æ ‘** - åŸºå°¼ç³»æ•°+æœ€å¤šä¸¤ä¸ªåˆ†æ”¯ï¼ˆä¹Ÿæ˜¯sklearnä¸­é‡‡ç”¨çš„ç®—æ³•ï¼‰


å†æ¬¡å›åˆ°å†³ç­–æ ‘çš„å½¢æˆï¼Œæ¯æ¬¡æ„å»ºä¸€ä¸ªå†³ç­–æ ‘ï¼Œæˆ‘ä»¬é€‰å–ä¸€ä¸ªç‰¹å¾ï¼Œç„¶åè®¡ç®—è¿™ä¸ªç‰¹å¾çš„åŸºå°¼ç³»æ•°æˆ–ä¿¡æ¯å¢ç›Šï¼Œé€‰å–**åŸºå°¼ç³»æ•°æœ€å°**æˆ–**ä¿¡æ¯å¢ç›Šæœ€å¤§**çš„ç‰¹å¾ï¼Œä½œä¸ºç¬¬ä¸€ä¸ªèŠ‚ç‚¹ã€‚å¯¹äºåˆ†ç±»å‡ºæ¥çš„æ•°æ®é›†ï¼Œæˆ‘ä»¬å†æµ‹è¯•å¹¶è®¡ç®—æ¯ä¸€ä¸ªç‰¹å¾çš„åŸºå°¼ç³»æ•°æˆ–ä¿¡æ¯å¢ç›Šã€‚

ä»¥æ­¤ç±»æ¨ï¼Œç›´åˆ°æœ€åæˆ‘ä»¬å°†æ‰€æœ‰æ•°æ®éƒ½åˆ†å¾—æ¸…æ¸…æ¥šæ¥šï¼Œæ¯ä¸€ä¸ªæœ€ç»ˆèŠ‚ç‚¹ä¸Šçš„æ•°æ®ï¼Œéƒ½æ˜¯ç™¾åˆ†ç™¾çº¯æ­£ï¼ˆåŒä¸€ç±»ï¼‰ï¼Œæˆ‘ä»¬å°±å®Œæˆäº†ä¸€ä¸ªå†³ç­–æ ‘ğŸŒ²ã€‚

## å†³ç­–æ ‘æ¨¡å‹çš„å¤æ‚åº¦
æ ¹æ®ç‰¹å¾çš„æ•°é‡ï¼Œä»¥åŠæ˜¯å¦å¯ä»¥é‡å¤é€‰æ‹©ç‰¹å¾æ„å»ºå†³ç­–æ ‘ï¼Œç†è®ºä¸Šå¯ä»¥æ„é€ å‡ºä¸€ä¸ªæ— é™æ·±çš„å†³ç­–æ ‘ï¼Œå¯ä»¥è¯´è¿™æ£µå†³ç­–æ ‘è¿‡äºè®¨å¥½è®­ç»ƒé›†ï¼Œè‡´åŠ›äºå°†è®­ç»ƒé›†ä¸­çš„æ¯ä¸€ä¸ªæ•°æ®ç‚¹æ­£ç¡®åˆ†ç±»ï¼Œå¯¼è‡´è¿‡æ‹Ÿåˆï¼Œé™ä½äº†æ¨¡å‹çš„æ³›åŒ–èƒ½åŠ›ã€‚

å†³ç­–æ ‘ä¸­å¯ä»¥é€šè¿‡è°ƒæ•´è¶…å‚,æ§åˆ¶æ¨¡å‹çš„å¤æ‚åº¦ï¼Œé¿å…è¿‡æ‹Ÿåˆçš„ç»“æœã€‚
* `max_depth`ï¼šå†³ç­–æ ‘çš„æœ€å¤§æ·±åº¦ï¼›
* `min_samples_leaf`ï¼šæ¯ä¸ªå¶å­æœ€å°‘åŒ…å«å‡ æ¡è®­ç»ƒæ•°æ®ï¼›
* `min_sample_split`ï¼šæ‹†åˆ†æŸèŠ‚ç‚¹è‡³å°‘éœ€è¦è¯¥èŠ‚ç‚¹åŒ…å«å¤šå°‘æ¡è®­ç»ƒæ•°æ®ï¼›
* `min_weight_fraction_leaf`ï¼šæ¯ä¸ªå¶å­èŠ‚ç‚¹çš„æ•°æ®æœ€å°‘è¦æœ‰å¤šå°‘æƒå€¼ï¼›
* `max_feature`ï¼šå¯é€‰å–çš„æœ€å¤šçš„ç‰¹å¾æ•°ç›®ï¼›
* `max_leaf_nodes`ï¼šä¸€ä¸ªèŠ‚ç‚¹æœ€å¤šèƒ½æœ‰å¤šå°‘å¶å­ï¼ˆå­èŠ‚ç‚¹ï¼‰ç­‰ã€‚

## sklearnä¸­çš„å†³ç­–æ ‘
scikit-learnæä¾›`DecisionTreeRegression`å’Œ`DecissionTreeClassifier`ä¸¤ç§ç®—æ³•ã€‚

ä¸‹é¢ä»£ç ä»¥breast canceræ•°æ®ä¸ºä¾‹
```python
from sklearn.datasets import load_breast_cancer
from sklearn.tree import DecisionTreeClassifier
from sklearn.model_selection import train_test_split

cancer = load_breast_cancer()
X_train, X_test, y_train, y_test = train_test_split(cancer.data, cancer.target, random_state=42)

tree = DecisionTreeClassifier(random_state=0).fit(X_train, y_train)

print("Accuracy on training set: {:.3f}".format(tree.score(X_train, y_train)))
print("Accuracy on test set: {:.3f}".format(tree.score(X_test, y_test)))
print("Depth: {}, leaves: {}".format(tree.get_depth(), tree.get_n_leaves()))
```

```
Accuracy on training set: 1.000
Accuracy on test set: 0.930
Depth: 7, leaves: 16
```

åœ¨æ²¡æœ‰æ§åˆ¶å†³ç­–æ ‘æ·±åº¦æ—¶ï¼Œåœ¨è®­ç»ƒé›†ä¸Šçš„å‡†ç¡®åº¦ä¸º100%ï¼Œè¯´æ˜æ¨¡å‹è¿‡æ‹Ÿåˆäº†ã€‚å°†`max_depth`è®¾ç½®ä¸º4åï¼Œå¾—åˆ°ä¸€ä¸ªè¾ƒä¸ºåˆç†çš„ç»“æœã€‚
```python
tree_d4 = DecisionTreeClassifier(max_depth=4, random_state=0).fit(X_train, y_train) 

print("Accuracy on training set: {:.3f}".format(tree_d4.score(X_train, y_train)))
print("Accuracy on test set: {:.3f}".format(tree_d4.score(X_test, y_test)))
print("Depth: {}, leaves: {}".format(tree_d4.get_depth(), tree_d4.get_n_leaves()))
```
```
Accuracy on training set: 0.995
Accuracy on test set: 0.951
Depth: 4, leaves: 12
```

### å¯è§†åŒ–å†³ç­–æ ‘
è¦è¿›ä¸€æ­¥äº†è§£æœºå™¨å­¦ä¹ æ¨¡å‹ï¼Œå¯è§†åŒ–æ°¸è¿œéƒ½æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„æ–¹æ³•ã€‚pythonä¹Ÿç»™å¯è§†åŒ–å†³ç­–æ ‘æä¾›å¾ˆæ£’çš„å·¥å…·åŒ…`graphviz`.

```python
dot_data = export_graphviz(tree_d4, out_file=None, feature_names=cancer.feature_names,  
                                class_names=['malignant','benign'],  
                                filled=True, rounded=True,  
                                special_characters=True) 

graph = graphviz.Source(dot_data)  
# å°†graphå­˜å‚¨ä¸ºå›¾ç‰‡(.png)
graph.render('dt_depth4',format='png', view=False)
```
![](/pics/dt_depth4.png)

è¿™é‡Œçš„`gini`ä¹Ÿå°±æ˜¯å‰é¢æåˆ°çš„åŸºå°¼ç³»æ•°ï¼Œ`value`ä»£è¡¨æ¯ä¸€ç±»åˆ«çš„æ•°é‡ã€‚å¯ä»¥çœ‹åˆ°ï¼Œå†ç»è¿‡**mean concave points**è¿™ä¸€ç‰¹å¾çš„åˆ†ç±»åï¼Œä¸¤ç§ç±»åˆ«åœ¨æ˜¯æˆ–å¦çš„åˆ†æ”¯ä¸Šï¼Œæ•°é‡å·®è·éƒ½æ›´å¤§äº†ã€‚

ğŸ’¡ å¯¹äºæ•°å€¼æ•°æ®ï¼Œå†³ç­–æ ‘ä¼šæ‰¾å‡ºå¤šä¸ªæ•°æ®åˆ†ç•Œçº¿ä¸€ä¸€æµ‹è¯•ï¼Œé€‰æ‹©ä¿¡æ¯å¢ç›Šæœ€å¤§çš„åˆ†ç•Œçº¿ä½œä¸ºèŠ‚ç‚¹çš„åˆ¤æ–­æ¡ä»¶ã€‚å¯¹äºç±»åˆ«æ•°æ®ï¼Œåˆ™éœ€è¦å…ˆå°†æ•°æ®ç±»åˆ«é¢„å¤„ç†ä¸ºæ•°å€¼ï¼Œå†æ ¹æ®ä¿¡æ¯å¢ç›Šé€‰å–èŠ‚ç‚¹ã€‚

## ç‰¹å¾é‡è¦æ€§(feature importance)
å¦å¤–ï¼Œå†³ç­–æ ‘æ¨¡å‹è¿˜è®¡ç®—ç‰¹å¾çš„é‡è¦æ€§ï¼Œå–å€¼èŒƒå›´åœ¨0åˆ°1ï¼Œ0è¡¨ç¤ºâ€œæœªä½¿ç”¨â€ï¼Œ1è¡¨ç¤ºâ€œå®Œç¾åœ°å°†æ•°æ®é›†åŒºåˆ†â€ã€‚
![](pics/dt1.png)

æ ¹æ®ä¸Šå›¾åˆ†æï¼Œ*mean concave points*æ˜¯æœ€é‡è¦ï¼Œæˆ–è€…è¯´ä¿¡æ¯é‡æœ€å¤§çš„ç‰¹å¾ï¼Œèƒ½å¤Ÿå°†å¤§éƒ¨åˆ†çš„æ•°æ®æ­£ç¡®åˆ†ç±»ã€‚ä½†éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œé‡è¦æ€§ä¸º0çš„ç‰¹å¾**å¹¶ä¸ä»£è¡¨å®ƒä»¬ä¸é‡è¦ï¼Œåªæ˜¯å®ƒä»¬åœ¨è¿™æ£µå†³ç­–æ ‘æ²¡æœ‰è¢«ç”¨åˆ°ã€‚**

å¦‚æœè¦åšæ›´å…¨é¢çš„è€ƒè™‘ï¼Œé€‰æ‹©æ›´å¤šçš„ç‰¹å¾å‚ä¸è®­ç»ƒï¼Œå°±éœ€è¦**é›†æˆå­¦ä¹ **ï¼Œé›†æˆå¤šä¸ªå†³ç­–æ ‘çš„å†³ç­–ã€‚

## æ€»ç»“
å†³ç­–æ ‘æ¨¡å‹ä¸»è¦æœ‰ä¸¤ä¸ªä¼˜ç‚¹
* å¯ä»¥è¢«å¯è§†åŒ–ï¼Œç›´è§‚æ˜“ç†è§£
* ä¸éœ€è¦å¯¹æ•°æ®åšç‰¹æ®Šå¤„ç†ï¼Œæ•°æ®æ‹¿åˆ°æ‰‹å°±å¯ç›´æ¥ç”¨

ä½†ç¼ºç‚¹ä¹Ÿå¾ˆæ˜æ˜¾
* å®¹æ˜“è¿‡æ‹Ÿåˆï¼Œæ³›åŒ–æ€§ä¸é«˜
* ä¸ä¸€å®šè€ƒè™‘æ‰€æœ‰çš„ç‰¹å¾ï¼Œå¿½ç•¥å…¶ä»–ç‰¹å¾çš„ä½œç”¨ã€‚

> å†³ç­–æ ‘æ˜¯ä¸€ä¸ªç®€å•æ˜“æ‡‚çš„æ¨¡å‹ï¼Œå…¶ç®—æ³•é€»è¾‘ä¹Ÿå¾ˆäººç±»åšå†³ç­–çš„è¿‡ç¨‹å¾ˆç›¸ä¼¼ï¼Œä½†å¦‚æœæˆ‘ä»¬è¦å¾—åˆ°ä¸€ä¸ªæ³›åŒ–æ€§æ›´å¥½çš„ç»“æœï¼Œå†³ç­–æ ‘å¾ˆéš¾åšåˆ°ã€‚

# å‚è€ƒèµ„æ–™
 1. [ã€ŠIntroduction to Machine Learning with Pythonã€‹](https://learning.oreilly.com/library/view/introduction-to-machine/9781449369880/)
 2. ä»£ç ï¼šhttps://github.com/PengJuan-AI/Machine-Learning-Practice/blob/main/CSDN_posts/notebooks/DecisionTree%26RandomForest.ipynb